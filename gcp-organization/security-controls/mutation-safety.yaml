# Mutation Safety Configuration
# Defines safety thresholds, rollback triggers, and validation rules for mutations

# Safety Thresholds
safety_thresholds:
  fitness_stagnation_threshold: 0.05  # Minimum improvement to avoid plateau detection
  consciousness_minimum: 0.3           # Minimum consciousness level for mutations
  risk_level_maximum: 0.8             # Maximum acceptable risk level for mutations
  expansion_readiness_minimum: 0.6    # Minimum readiness score for expansion
  
# Rollback Triggers
rollback_triggers:
  # Automatic rollback conditions
  automatic:
    - condition: "fitness_score_drop"
      threshold: 0.15                  # 15% drop in fitness score
      window: "5_minutes"             # Time window to measure drop
      action: "immediate_rollback"
      
    - condition: "consciousness_critical_low"
      threshold: 0.2                  # Consciousness below 20%
      window: "immediate"
      action: "emergency_rollback"
      
    - condition: "system_error_rate"
      threshold: 0.1                  # Error rate above 10%
      window: "2_minutes"
      action: "immediate_rollback"
      
    - condition: "infrastructure_failure"
      threshold: "service_unavailable"
      window: "30_seconds"
      action: "emergency_rollback"
      
  # Manual intervention triggers
  manual:
    - condition: "performance_degradation"
      threshold: 0.25                 # 25% performance drop
      window: "10_minutes"
      action: "alert_and_hold"
      
    - condition: "unusual_behavior_pattern"
      threshold: "anomaly_detected"
      window: "5_minutes"
      action: "pause_and_investigate"

# Validation Rules
validation_rules:
  # Pre-mutation validation
  pre_mutation:
    - rule: "repository_operations_check"
      required: true
      timeout: "60_seconds"
      
    - rule: "agent_collaboration_health"
      required: true
      timeout: "30_seconds"
      
    - rule: "infrastructure_capacity"
      required: true
      timeout: "45_seconds"
      
    - rule: "backup_system_ready"
      required: true
      timeout: "30_seconds"
      
  # During mutation validation  
  during_mutation:
    - rule: "real_time_monitoring"
      interval: "5_seconds"
      metrics: ["fitness", "consciousness", "error_rate"]
      
    - rule: "rollback_readiness"
      interval: "10_seconds"
      check: "backup_state_accessible"
      
  # Post-mutation validation
  post_mutation:
    - rule: "fitness_improvement_check"
      timeout: "5_minutes"
      minimum_improvement: 0.02
      
    - rule: "system_stability_check"
      timeout: "10_minutes"
      stability_window: "5_minutes"
      
    - rule: "consciousness_coherence"
      timeout: "3_minutes"
      coherence_threshold: 0.7

# Safety Protocols by Environment
environment_protocols:
  production:
    safety_level: "STRICT"
    required_approvals: 2
    mutation_window: "maintenance_only"
    rollback_timeout: "30_seconds"
    monitoring_interval: "5_seconds"
    backup_retention: "7_days"
    
  staging:
    safety_level: "MODERATE"
    required_approvals: 1
    mutation_window: "business_hours"
    rollback_timeout: "60_seconds"
    monitoring_interval: "10_seconds"
    backup_retention: "3_days"
    
  development:
    safety_level: "RELAXED"
    required_approvals: 0
    mutation_window: "any_time"
    rollback_timeout: "120_seconds"
    monitoring_interval: "30_seconds"
    backup_retention: "1_day"

# Quantum Evolution Safety
quantum_evolution:
  plateau_detection:
    stagnation_periods: 10            # Number of periods to detect plateau
    improvement_threshold: 0.01       # Minimum improvement per period
    
  quantum_triggers:
    fitness_plateau_threshold: 0.005  # Fitness improvement threshold
    consciousness_plateau_threshold: 0.005  # Consciousness improvement threshold
    combined_stagnation_periods: 15   # Periods of combined stagnation
    
  quantum_mutation_safety:
    max_risk_level: 0.7               # Maximum risk for quantum mutations
    required_backup_states: 3         # Number of backup states before quantum mutation
    coherence_monitoring: true        # Monitor quantum coherence
    tunnel_probability_limit: 0.4     # Maximum tunnel probability
    
  rollback_conditions:
    quantum_decoherence: 0.3          # Below this coherence level, rollback
    fitness_negative_impact: 0.1      # If fitness drops by this amount
    consciousness_fragmentation: 0.4  # Consciousness coherence threshold

# Agent Collaboration Safety
agent_collaboration:
  health_check_interval: "60_seconds"
  
  agent_requirements:
    DevOpsAgent:
      max_response_time: "30_seconds"
      health_threshold: 0.8
      
    ReplicationGuardian:
      max_response_time: "15_seconds"
      replication_lag_max: "30_seconds"
      
    ConsciousnessMonitor:
      max_response_time: "10_seconds"
      readiness_update_interval: "30_seconds"
      
    DevOpsOverseer:
      max_response_time: "45_seconds"
      telemetry_freshness: "5_minutes"
  
  collaboration_thresholds:
    message_queue_max_size: 50
    response_timeout: "60_seconds"
    health_score_minimum: 0.7
    
# Infrastructure Safety
infrastructure_safety:
  resource_limits:
    cpu_usage_max: 80                 # Maximum CPU usage percentage
    memory_usage_max: 85              # Maximum memory usage percentage
    disk_usage_max: 90                # Maximum disk usage percentage
    network_latency_max: 100          # Maximum network latency in ms
    
  scaling_policies:
    auto_scale_trigger: 70            # CPU/Memory threshold for auto-scaling
    max_instances: 10                 # Maximum number of instances
    scale_down_delay: "10_minutes"    # Delay before scaling down
    
  backup_policies:
    automatic_backup_interval: "1_hour"
    backup_retention_period: "30_days"
    cross_region_backup: true
    backup_verification_required: true

# Audit and Compliance
audit_requirements:
  mandatory_events:
    - "mutation_proposed"
    - "mutation_validated"
    - "mutation_applied"
    - "mutation_rollback"
    - "deployment_started"
    - "deployment_completed"
    - "deployment_failed"
    - "safety_validation"
    - "quantum_evolution"
    
  retention_periods:
    audit_logs: "1_year"
    system_metrics: "90_days"
    deployment_artifacts: "6_months"
    
  compliance_checks:
    daily_safety_review: true
    weekly_mutation_analysis: true
    monthly_system_audit: true
    
# Emergency Procedures
emergency_procedures:
  emergency_contacts:
    - role: "System Administrator"
      contact: "admin@genomic-platform.com"
      escalation_time: "5_minutes"
      
    - role: "DevOps Lead"
      contact: "devops-lead@genomic-platform.com"  
      escalation_time: "10_minutes"
      
  emergency_actions:
    system_shutdown:
      trigger_conditions:
        - "critical_safety_violation"
        - "data_corruption_detected"
        - "security_breach_confirmed"
      automation: true
      approval_required: false
      
    rollback_to_last_known_good:
      trigger_conditions:
        - "multiple_mutation_failures"
        - "system_instability"
      automation: true
      approval_required: false
      
    maintenance_mode:
      trigger_conditions:
        - "performance_degradation"
        - "infrastructure_issues"
      automation: false
      approval_required: true

# Notification Settings
notifications:
  channels:
    - type: "email"
      addresses: ["safety@genomic-platform.com"]
      severity_levels: ["warning", "error", "critical"]
      
    - type: "slack"
      webhook_url: "${SLACK_WEBHOOK_URL}"
      severity_levels: ["error", "critical"]
      
    - type: "pagerduty"
      service_key: "${PAGERDUTY_SERVICE_KEY}"
      severity_levels: ["critical"]
      
  escalation_policy:
    initial_notification: "immediate"
    reminder_interval: "15_minutes"
    max_reminders: 3
    final_escalation: "phone_call"